- 사용자는 무언가를 실행할 때 동작하기까지 걸린 시간으로 성능을 판단하지만 실제로는 다양한 지표가 성능과 관련되어 있다. 
네트워크 속도, 디스크 속도, 메모리 크기, 디바이스(스마트 폰)의 CPU 속도 등이 여기에 해당한다. 이런 다양한 지표 중에서 서버 성능과 관련 있는 중요한 지표를 2가지 꼽자면 응답 시간과 처리량을 들 수 있다.
- 성능을 개선하려면 먼저 현재 서버의 TPS와 응답 시간을 알아야 한다. 막연히 성능이 느리다고 말하면서 이것저것 시도하면 안 된다.
- 급한 불을 끄는 방법 중 하나는 수직 확장 scale-up 을 하는 것이다. 수직 확장은 CPU, 메모리, 디스크 등의 자원을 증가시키는 것을 말한다.
- 따라서 트래픽이 증가하면 서버를 추가로 투입해 TPS를 높이는 방법도 고려해야 한다. 이렇게 서버를 늘리는 방법을 수평 확장 scale-out 이라고 한다.
- 외부 API의 성능이 개선되지 않는 한 서버를 추가한다고 해도 TPS는 향상되지 않는다. DB나 외부 API에 성능 문제가 발생하지 않는 범위 내에서만 수평 확장을 해야 효과가 있다.
- 매 요청마다 DB를 연결하고 종료하면 트래픽이 증가할 때 급격하게 처리량이 떨어지기도 한다.
- 이런 문제를 피하기 위해 DB 커넥션 풀을 사용한다. DB 커넥션 풀은 DB에 연결된 커넥션을 미리 생성해서 보관한다. 애플리케이션은 DB 작업이 필요할 때 풀에서 커넥션을 가져와 사용 하고, 작업이 끝나면 다시 풀에 반환한다
- 커넥션 풀은 다양한 설정을 제공한다. 그중 중요한 설정은 다음과 같다.
    - 커넥션 풀 크기(또는 최소 크기, 최대 크기)
    - 풀에 커넥션이 없을 때 커넥션을 구할 때까지 대기할 시간
    - 커넥션의 유지 시간(최대 유휴 시간, 최대 유지 시간)
- 커넥션 풀 크기는 커넥션 풀에 미리 생성해둘 커넥션 개수를 지정하는 설정이다. 커넥션 풀 설정에서 가장 중요하다.
- 그러나 커넥션 풀 크기를 무턱대고 늘리면 안된다. DB 상태를 보고 늘려야 한다.
- 대기 시간이란 풀에 사용할 수 있는 커넥션이 없을 때 커넥션을 얻기 위해 기다릴 수 있는 최대 시간을 의미한다.
- 트래픽의 양이나 서비스의 특성에 따라 차이는 있지만 보통의 경우라면 0.5초에서 3초 이내로 지정하자.
- 커넥션을 얻지 못했을 때 빠르게 에러를 응답해야 서버의 부하가 증가하는 것도 방지할 수 있다.
- 최대 유휴 시간은 사용되지 않는 커넥션을 풀에 유지할 수 있는 최대 시간을 의미한다.
- 커넥션 풀이 제공하는 또 다른 설정은 최대 유지 시간이다. ... 4시간이 자나면 커넥션이 유효하더라도 커넥션을 닫고 풀에서 제거된다.
- 최대 유휴 시간과 유지 시간을 무한대로 설정하지 않는 것이 좋다.
- DB 서버를 확장하지 않고도 응답 시간과 처리량을 개선하고 싶다면 캐시 사용을 고려할 수 있다.
- DB 뿐만 아니라 복잡한 계산 결과나 외부 API 연동 결과도 캐시에 보관하여 응답 시간을 줄이는 데 활용할 수 있다.
- 하지만 캐시에 모든 데이터를 무작정 저장할 수는 없다. 캐시는 메모리 자원을 사용하기 때문이다.
- 삭제할 대상을 선택할 때 주로 사용하는 규칙은 다음과 같다.
    - LRU (Least Recently Used)
    - LFU (Least Frequently Used)
    - FIFO (First in First Out)
- 이를 위해 캐시에는 유효 시간을 설정하는 방식도 함께 사용한다.
- 서버가 사용하는 캐시에는 두 종류(로컬 캐시, 리모트 캐시)가 있다.
- 로컬 캐시는 서버 프로세스와 동일한 메모리를 캐시 저장소로 사용한다.
- 리모트 캐시는 별도 프로세스를 캐시 저장소로 사용한다.
- 로컬 캐시의 장점은 속도에 있다. 단점은 캐시에 저장할 수 있는 데이터 크기에 제한이 있다는 점과 서버 프로세스를 재시작하면 캐시가 삭제된다는 점이다.
- 리모트 캐시의 장점은 캐시 크기를 유연하게 확장할 수 있다는 것이다. 단점은 네트워크 통신에 의한 상대적으로 느린 속도이다.
- 배포 빈도가 높은 서비스라면 리모트 캐시 사용을 적극적으로 고려하자.
- 트래픽이 순간적으로 급증하는 패턴을 보인다면 캐시에 데이터를 미리 저장하는 것도 고려할 필요가 있다.
- 변경에 민감한 데이터는 로컬 캐시가 아닌 리모트 캐시에 보관해야 한다. 로컬 캐시는 자신의 데이터만 변경하지 다른 서버의 로컬 캐시는 변경하지 않기 때문이다.
- 서버는 사용자의 네트워크 속도를 제어할 수 없지만 전송하는 데이터의 크기는 제어할 수 있다. 이때 사용할 수 있는 방법이 바로 응답 데이터를 압축해서 전송하는 것이다.
- 브라우저 캐시를 활용하면 서버 입장에서도 전송해야 할 트래픽이 줄어들어 그만큼 네트워크 전송 비용을 아낄 수 있다.
- CDN 은 콘텐츠를 제공하기 위한 별도의 네트워크를 의미한다. 이미지, JS 같은 정적 자원을 CDN으로 제공하면 오리진 서버가 처리해야 할 트래픽을 상당히 줄일 수 있다.
- 처리할 수 있는 시스템의 처리량을 무작정 늘리기보다는 수용할 수 있는 수준의 트래픽만 받아들이고 나머지는 대기 처리하는 방법도 있다. 
